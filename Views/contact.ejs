<%- include('layout/header') %>
<div class="container">
  <h1>Formulaire de contact</h1>
  <div id="alert"></div>
  <form class="row g-3 m-3" id="contactForm" method="POST" action="/test">
    <div class="col-md-6">
      <label for="inputNomPrenom" class="form-label">Nom et prénom</label>
      <input type="text" class="form-control" id="inputNomPrenom" />
    </div>
    <div class="col-md-6">
      <label for="inputEmail" class="form-label">Email</label>
      <input type="email" class="form-control" id="inputEmail" />
    </div>
    <div class="col-md-8">
      <label for="inputCompanyName" class="form-label"
        >Nom de l'entreprise</label
      >
      <input type="text" class="form-control" id="inputCompanyName" />
    </div>
    <div class="col-md-4">
      <label for="inputSecteur" class="form-label">Secteur d'activité</label>
      <select id="inputSecteur" class="form-select">
        <!-- <option selected>Choisir...</option> -->
        <option>Public</option>
        <option>Privé</option>
        <option>ESN</option>
      </select>
    </div>
    <div class="col-md-4">
      <label for="inputPhone" class="form-label" required="required"
        >Numéro de téléphone</label
      >
      <input type="text" class="form-control" id="inputPhone" />
    </div>
    <div class="col-md-4">
      <label for="inputCountry" class="form-label">Pays</label>
      <input
        type="text"
        class="form-control"
        id="inputCountry"
        placeholder="France, Espagne..." />
    </div>
    <div class="col-md-4">
      <label for="inputCity" class="form-label">Ville</label>
      <input type="text" class="form-control" id="inputCity" />
    </div>
    <div class="form-group">
      <label for="exampleFormControlTextarea1">Example textarea</label>
      <textarea
        class="form-control"
        id="exampleFormControlTextarea1"
        rows="3"></textarea>
    </div>
    <div class="col-12">
      <div class="form-check">
        <input
          class="form-check-input"
          type="checkbox"
          id="gridCheck"
          checked />
        <label class="form-check-label" for="gridCheck">
          je reconnais d'avoir pris connaissance que les information fournies
          sont utilisées pour la prise de contact
        </label>
      </div>
    </div>
    <div class="col-12">
      <button type="submit" class="btn btn-primary" id="submitButton">
        Enregistrer
      </button>
    </div>
  </form>
  <!-- Début du script pour gérer l'envoie des données client -->
  <script>
    let contactForm = document.getElementById("contactForm");

    contactForm.onsubmit = async () => {
      event.preventDefault();
      const listInfoForm = Array.from(contactForm.elements);
      let listDataForm = [];
      listInfoForm.forEach((elm) => {
        listDataForm.push(document.getElementById(elm.id).value);
      });

      let dataForm = {
        firstLatsName: listDataForm[0],
        email: listDataForm[1],
        companyName: listDataForm[2],
        Country: listDataForm[5],
        city: listDataForm[6],
        phoneNumber: listDataForm[4],
        text: listDataForm[7],
      };
      //  des conditions à satisfaire pour l'envoie
      if (
        dataForm.email.length === 0
        // ||       dataForm.phoneNumber.length === 0
      ) {
        document.getElementById("alert").innerHTML = alertHTML(
          "danger",
          `Problème d'enregistrement! l'adresse email est requise pour pouvoir vous contacter`
        );
        document.getElementById("inputEmail").style.backgroundColor =
          "hsl(30, 100%, 50%)";
        return false;
      }
      document.getElementById("inputEmail").style.backgroundColor = "white";
      let checBx = document.getElementById("gridCheck");
      if (!checBx.checked) {
        document.getElementById("alert").innerHTML = alertHTML(
          "danger",
          `Vous devez etre d'accord avec la politique d'utilisation de vos données`
        );
        checBx.style.backgroundColor = "hsl(30, 100%, 50%)";
        return false;
      }

      var fetchOptions = {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ data: dataForm }),
      };
      let data = await fetch("/contact/saveContact", fetchOptions);
      let json = await data.json();
      console.log(json);
      if (json.status_code === 200) {
        contactForm.reset();
        document.getElementById("alert").innerHTML = alertHTML(
          "success",
          "Formulaire enregistré avec succèes!"
        );
      } else {
        document.getElementById("alert").innerHTML = alertHTML(
          "danger",
          `Problème d'enregistrement sur le serveur !`
        );
      }
    };

    let alertHTML = (state, text) => {
      return `<div class="alert alert-${state}" role="alert">
       ${text}
      </div>`;
    };
  </script>
</div>
<%- include('layout/footer') %>
